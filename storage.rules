rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Public read access for site assets (avatars, etc.)
    match /site_assets/{allPaths=**} {
      allow read;
      // Write access for authenticated users (admins) to manage assets
      allow write: if request.auth != null;
    }

    // Public read access for knowledge base files is required by the
    // Genkit flow that processes documents via public URL.
    match /knowledge_base_files/{allPaths=**} {
      allow read;
      // Write access (upload/delete) for authenticated users (admins)
      allow write: if request.auth != null;
    }
  }
}
