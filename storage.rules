rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Default deny all reads and writes
    // match /{allPaths=**} {
    //  allow read, write: if false;
    // }

    // Allow authenticated users (admins) to write to the knowledge base and site assets folders.
    match /knowledge_base_files/{level}/{fileId} {
      allow write: if request.auth != null;
    }

    match /site_assets/{assetName} {
      allow write: if request.auth != null;
    }

    // Allow anyone to READ/GET from knowledge base and site assets.
    // This is required for the UI to display images and for users to download referenced PDFs.
    match /knowledge_base_files/{level}/{allFiles=**} {
      allow get: if true;
    }
     match /site_assets/{allFiles=**} {
      allow get: if true;
    }

    // Allow anyone to write their chat history for RAG processing.
    match /chat_history_files/{fileId} {
      allow write: if true;
    }
  }
}
