rules_version = '2';

// Quick Reference for Match Paths:
// - /b/{bucket}/o: Matches all objects in the bucket.
// - site_assets/{allPaths=**}: Matches all files within the site_assets folder.
// - knowledge_base_files/{allPaths=**}: Matches all files in the knowledge_base_files folder.
// - chat_history_files/{allPaths=**}: Matches files in the chat_history_files folder.

service firebase.storage {
  match /b/{bucket}/o {

    // PUBLIC READ-ONLY: Site assets (logos, backgrounds) and knowledge base files (PDFs for download)
    // Anyone should be able to read these files. Only authenticated users (admins) can write/delete them.
    match /site_assets/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    match /knowledge_base_files/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // ANONYMOUS WRITE: Chat history transcripts
    // The client-side application needs to be able to upload chat transcripts (as PDFs)
    // without requiring the end-user to be logged in. This path is write-only for clients.
    match /chat_history_files/{allPaths=**} {
      allow read: if request.auth != null; // Only admins can read back history files
      allow write: if true; // Anyone can write
    }

    // DEFAULT RULE: Deny all other read/write operations by default.
    // This is a security best practice. Any path not explicitly matched above will be denied.
    // Note: This rule is implicitly active if no other rule matches. The explicit matches above
    // provide all the necessary permissions.
  }
}
