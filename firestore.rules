rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow public read access to site configuration for the front-end client.
    // Only authenticated admins can write to these settings.
    match /configurations/{docId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // This single rule secures all knowledge base metadata collections.
    // It uses a wildcard `{level}` to match any collection name that fits
    // the pattern (e.g., kb_high_meta, kb_medium_meta, etc.).
    // Access is restricted to authenticated users (i.e., your server functions).
    match /kb_{level}_meta/{docId} {
      allow read, write: if request.auth != null;
    }

    // Secure the collection where all document chunks and their embeddings are stored.
    // Access is restricted to authenticated users (i.e., your server functions).
    match /kb_chunks/{chunkId} {
      allow read, write: if request.auth != null;
    }
    
    // Secure the site errors collection.
    // Any process can write (to log an error), but only admins can read or delete.
    match /site_errors/{errorId} {
      allow read, delete: if request.auth != null;
      allow create: if true;
    }
  }
}
