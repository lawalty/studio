rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Allow public read access to site configuration for the splash screen and chat interface.
    // Writes should only be done from the admin console or a secure backend.
    match /configurations/{docId} {
      allow read: if true;
      allow write: if request.auth != null; // Basic protection: only signed-in users (admins) can write.
    }

    // Allow the admin panel to read all knowledge base metadata and chunks.
    // Writes are handled by server-side Genkit flows which bypass these rules.
    match /kb_chunks/{chunkId} {
      allow read: if true;
      allow write: if false; // Chunks are written by the backend only.
    }
    
    match /kb_high_meta_v1/{sourceId} {
      allow read: if true;
      allow write: if false; // Metadata is written by the backend only.
    }
    
    match /kb_medium_meta_v1/{sourceId} {
      allow read: if true;
      allow write: if false; // Metadata is written by the backend only.
    }
    
    match /kb_low_meta_v1/{sourceId} {
      allow read: if true;
      allow write: if false; // Metadata is written by the backend only.
    }
    
    match /kb_archive_meta_v1/{sourceId} {
      allow read: if true;
      allow write: if false; // Metadata is written by the backend only.
    }

    // Default deny all other collections.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
