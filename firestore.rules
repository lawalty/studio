
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check for admin authentication
    function isAdmin() {
      return request.auth != null;
    }

    // Rules for configuration documents. Public read, admin write.
    match /configurations/{docId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // Rules for knowledge base metadata. Admin only.
    match /kb_high_meta/{docId} { allow read, write: if isAdmin(); }
    match /kb_medium_meta/{docId} { allow read, write: if isAdmin(); }
    match /kb_low_meta/{docId} { allow read, write: if isAdmin(); }
    match /kb_spanish_pdfs_meta/{docId} { allow read, write: if isAdmin(); }
    match /kb_chat_history_meta/{docId} { allow read, write: if isAdmin(); }
    match /kb_archive_meta/{docId} { allow read, write: if isAdmin(); }
    
    // Rules for knowledge base data chunks. Admin only.
    // Client does not need direct access. Server-side flows handle this.
    match /kb_chunks/{chunkId} {
      allow read, write: if isAdmin();
    }

    // Rules for site errors log. Allow client to write, admin to read/delete.
    match /site_errors/{errorId} {
      allow create: if true;
      allow read, delete: if isAdmin();
    }
  }
}
